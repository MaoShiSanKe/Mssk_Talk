<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理后台</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/admin.css">
</head>
<body>

  <!-- 登录界面 -->
  <div id="login-screen">
    <div class="login-card">
      <h2 data-i18n="admin.login_title">管理后台</h2>
      <input
        type="password"
        id="password-input"
        data-i18n-attr="placeholder"
        data-i18n="admin.password_placeholder"
        placeholder="请输入密码"
      >
      <button id="login-btn" data-i18n="admin.login_btn">登录</button>
      <p id="login-error"></p>
    </div>
  </div>

  <!-- 主界面 -->
  <div id="admin-screen">
    <div class="topbar">
      <h1 data-i18n="admin.login_title">管理后台</h1>
      <div style="display:flex;align-items:center;gap:8px;">
        <button class="scheme-toggle" style="background:none;border:1px solid var(--border);border-radius:12px;cursor:pointer;font-size:0.78rem;padding:4px 10px;color:var(--text-secondary);font-family:inherit;" title="切换配色方案">🔵 冷色</button>
        <button class="theme-toggle" style="background:none;border:none;cursor:pointer;font-size:1rem;padding:4px;" title="切换主题">🌙</button>
        <button id="logout-btn" data-i18n="admin.logout">退出</button>
      </div>
    </div>

    <div class="main-content">

      <!-- 统计 -->
      <div class="stats">
        <div class="stat-card">
          <div class="number" id="stat-total">—</div>
          <div class="label" data-i18n="admin.stats_total">总消息</div>
        </div>
        <div class="stat-card">
          <div class="number" id="stat-unread">—</div>
          <div class="label" data-i18n="admin.stats_unread">未读</div>
        </div>
        <div class="stat-card">
          <div class="number" id="stat-visitors">—</div>
          <div class="label" data-i18n="admin.stats_visitors">用户数</div>
        </div>
      </div>

      <!-- 设置面板 -->
      <div class="section-title section-toggle" id="settings-toggle">
        <span>系统设置</span>
        <span class="toggle-arrow" id="settings-arrow">▸</span>
      </div>
      <div id="settings-panel" class="settings-panel" style="display:none">
        <p class="loading">加载中…</p>
      </div>

      <!-- 访客统计 -->
      <div class="section-title section-toggle" id="vstats-toggle">
        <span>访客统计</span>
        <span class="toggle-arrow" id="vstats-arrow">▸</span>
      </div>
      <div id="vstats-panel" class="vstats-panel" style="display:none">
        <p class="loading">加载中…</p>
      </div>

      <!-- 精选管理 -->
      <div class="section-title section-toggle" id="featured-mgr-toggle" style="margin-top:16px">
        <span>精选管理</span>
        <span class="toggle-arrow" id="featured-mgr-arrow">▸</span>
      </div>
      <div id="featured-mgr-panel" class="featured-mgr-panel" style="display:none">
        <div id="featured-mgr-list">
          <p class="loading">加载中…</p>
        </div>
      </div>

      <!-- 屏蔽词管理 -->
      <div class="section-title section-toggle" id="bwords-toggle" style="margin-top:16px">
        <span>屏蔽词管理</span>
        <span class="toggle-arrow" id="bwords-arrow">▸</span>
      </div>
      <div id="bwords-panel" class="bwords-panel" style="display:none">
        <div class="bwords-input-row">
          <input type="text" id="bword-input" placeholder="输入屏蔽词，回车添加" class="bword-input">
          <button id="bword-add-btn" class="bword-add-btn">添加</button>
        </div>
        <div id="bwords-list" class="bwords-list">
          <p class="loading">加载中…</p>
        </div>
      </div>

      <div class="section-title" style="margin-top:28px">消息管理</div>

      <!-- 工具栏：过滤器 + 搜索 + 导出 -->
      <div class="toolbar">
        <div class="filters">
          <button class="filter-btn active" id="filter-all" data-i18n="admin.all_messages">全部消息</button>
          <button class="filter-btn" id="filter-unread" data-i18n="admin.unread_only">仅未读</button>
          <button class="filter-btn" id="filter-blocked">显示已屏蔽</button>
          <button class="filter-btn" id="filter-word-blocked">屏蔽词拦截</button>
        </div>
        <input type="text" id="search-input" class="search-input" placeholder="搜索消息、联系方式、备注…">
        <div style="position:relative;display:inline-block;">
          <button id="export-btn" class="export-btn">导出 CSV ▾</button>
          <div id="export-panel" class="export-panel" style="display:none">
            <p class="export-panel-title">导出范围</p>
            <label class="export-radio">
              <input type="radio" name="export-scope" value="all" checked> 全部消息
            </label>
            <label class="export-radio">
              <input type="radio" name="export-scope" value="current"> 当前视图（含搜索/过滤结果）
            </label>
            <div class="export-divider"></div>
            <label class="export-check">
              <input type="checkbox" id="export-include-blocked"> 包含手动屏蔽的消息
            </label>
            <label class="export-check">
              <input type="checkbox" id="export-include-word-blocked"> 包含屏蔽词拦截的消息
            </label>
            <button id="export-confirm-btn" class="export-confirm-btn">确认导出</button>
          </div>
        </div>
      </div>

      <!-- 消息列表 -->
      <div id="message-list">
        <p class="loading" data-i18n="admin.loading">加载中……</p>
      </div>

      <!-- 分页 -->
      <div id="pagination" class="pagination"></div>

    </div>
  </div>

  <footer>
    <a href="https://github.com/MaoShiSanKe/Mssk_Talk" target="_blank" rel="noopener">Mssk_Talk on GitHub</a>
  </footer>

  <script src="./js/theme.js"></script>
  <script src="./js/config.js"></script>
  <script src="./js/i18n.js"></script>
  <script src="./js/supabase.js"></script>
  <script src="./js/admin.js"></script>
</body>
</html>